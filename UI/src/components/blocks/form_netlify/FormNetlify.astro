---
// imports & styles same as before
import Button from "@components/shared/Button.astro";
import Label from "./components/Label.astro";

const baseStyle =
  "peer w-full border-b border-elynx-orange bg-transparent pt-4 pb-1.5 outline outline-0 transition-all ";
const fontStyle = "font-sans text-sm font-normal text-heading-2";
const disable = "disabled:border-0 disabled:bg-elynx-orange";
const focus = "focus:outline-0  focus:border-elynx-orange focus:border-0";
const placeHolder = "placeholder-shown:border-elynx-orange";
---

<div class="flex sm:flex-row flex-col gap-5 w-full">
  <form
    id="contact-form"
    action="https://formspree.io/f/xnnwpkpa"   
    method="POST"
    class="py-1 pl-6 w-full pr-1 flex flex-col gap-8 items-center text-heading-3
           border-box-border rounded ease-linear focus-within:bg-body focus-within:border-elynx-orange pt-8"
  >
    <Label>
      <input
        slot="labelInput"
        type="text"
        name="name"
        placeholder="First, Last"
        required
        class:list={[baseStyle, fontStyle, disable, focus, placeHolder]}
      />
      Name
    </Label>

    <Label>
      <input
        slot="labelInput"
        type="email"
        name="email"
        placeholder="email@example.com"
        required
        class:list={[baseStyle, fontStyle, disable, focus, placeHolder]}
      />
      Email
    </Label>

    <Label>
      <textarea
        slot="labelInput"
        name="message"
        rows="5"
        required
        class:list={[
          baseStyle,
          fontStyle,
          disable,
          focus,
          placeHolder,
          " resize-none disabled:resize-none ",
        ]}
      ></textarea>
      Tell us about your project!
    </Label>

    <!-- Optional spam honeypot -->
    <p class="hidden">
      <label>
        Donâ€™t fill this out: <input name="_gotcha" />
      </label>
    </p>

    <Button variant="secondary" type="submit">
      <span class="sm:flex relative z-[5]">Send</span>
    </Button>
  </form>

  <p
    id="contact-status"
    class="mt-3 text-sm text-elynx-orange opacity-0 transition-opacity duration-200"
  >
    <!-- filled in by JS -->
  </p>
</div>

<style>
  input,
  textarea {
    background: #ffffff0d;
    margin-top: 10px;
  }
</style>

<script>
  // runs in browser after load
  const form = document.getElementById("contact-form");
  const status = document.getElementById("contact-status");

  if (form && status) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault(); // stop default redirect

      const data = new FormData(form);
      const submitBtn = form.querySelector('button[type="submit"]');
      if (submitBtn) submitBtn.disabled = true;

      try {
        const res = await fetch(form.action, {
          method: "POST",
          body: data,
          headers: { Accept: "application/json" },
        });

        if (res.ok) {
          form.reset(); // 1) clear fields
          status.textContent = "thank you! we'll be in touch soon.";
        } else {
          status.textContent =
            "Oops, something went wrong. Please email us directly.";
        }
      } catch (err) {
        status.textContent = "Network error. Please try again.";
      } finally {
        status.style.opacity = "1"; // 2) show message
        if (submitBtn) submitBtn.disabled = false;
      }
    });
  }
</script>
